<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cofrinho - Controle Financeiro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(135deg, #e1bee7 0%, #ce93d8 50%, #ba68c8 100%);
            min-height: 100vh;
            padding-bottom: 2rem;
        }

        .app-header {
            background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%);
            color: white;
            padding: 2rem 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            text-align: center;
        }

        .app-header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }

        .money-icon {
            font-size: 3.5rem;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .grid-layout {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.15);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(156, 39, 176, 0.25);
        }

        .card h2 {
            color: #7b1fa2;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .form-group label {
            font-weight: 600;
            color: #7b1fa2;
            font-size: 0.9rem;
        }

        input, select, button {
            padding: 0.75rem;
            border: 2px solid #e1bee7;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #9c27b0;
        }

        .btn-primary {
            background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%);
            color: white;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(156, 39, 176, 0.3);
        }

        .btn-delete {
            background: #ef5350;
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0;
        }

        .btn-delete:hover {
            background: #d32f2f;
        }

        .color-picker {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin: 0.5rem 0;
        }

        .color-option {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.active {
            border-color: #333;
            transform: scale(1.15);
        }

        .categories-list, .transactions-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .category-item, .transaction-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: #f3e5f5;
            border-radius: 8px;
        }

        .category-color {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }

        .summary-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem;
            background: #f3e5f5;
            border-radius: 12px;
            margin-bottom: 1rem;
        }

        .summary-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .summary-value.income { color: #2e7d32; }
        .summary-value.expense { color: #c62828; }
        .summary-value.balance.positive { color: #2e7d32; }
        .summary-value.balance.negative { color: #c62828; }

        .chart-container {
            margin-top: 1rem;
            position: relative;
            height: 300px;
        }

        .recommendations-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .recommendation-item {
            padding: 1rem;
            background: #f3e5f5;
            border-radius: 12px;
            border-left: 4px solid #9c27b0;
        }

        .type-toggle {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .type-btn {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid #e1bee7;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        .type-btn.active.income {
            background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
            color: white;
            border-color: #2e7d32;
        }

        .type-btn.active.expense {
            background: linear-gradient(135deg, #ef5350 0%, #c62828 100%);
            color: white;
            border-color: #c62828;
        }

        @media (max-width: 768px) {
            .grid-layout {
                grid-template-columns: 1fr;
            }
            .app-header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <header class="app-header">
        <div class="header-content">
            <h1>
                <span class="money-icon">üí∞</span>
                Cofrinho
            </h1>
            <p class="subtitle">Controle Financeiro Pessoal</p>
        </div>
    </header>

    <main class="container">
        <div class="grid-layout">
            <!-- Categorias -->
            <section class="card">
                <h2>üìÅ Categorias</h2>
                <form id="categoryForm">
                    <div class="form-group">
                        <input type="text" id="categoryName" placeholder="Nome da categoria" required>
                    </div>
                    <div class="form-group">
                        <select id="categoryType">
                            <option value="expense">Sa√≠da</option>
                            <option value="income">Entrada</option>
                        </select>
                    </div>
                    <div class="color-picker" id="colorPicker"></div>
                    <button type="submit" class="btn-primary">Adicionar</button>
                </form>
                <div class="categories-list" id="categoriesList"></div>
            </section>

            <!-- Nova Transa√ß√£o -->
            <section class="card">
                <h2>‚ûï Nova Transa√ß√£o</h2>
                <form id="transactionForm">
                    <div class="type-toggle">
                        <button type="button" class="type-btn active expense" data-type="expense">üí∏ Sa√≠da</button>
                        <button type="button" class="type-btn income" data-type="income">üí∞ Entrada</button>
                    </div>
                    <div class="form-group">
                        <select id="transactionCategory" required></select>
                    </div>
                    <div class="form-group">
                        <input type="number" id="transactionAmount" step="0.01" min="0" placeholder="Valor (R$)" required>
                    </div>
                    <div class="form-group">
                        <input type="text" id="transactionDescription" placeholder="Descri√ß√£o" required>
                    </div>
                    <div class="form-group">
                        <input type="date" id="transactionDate" required>
                    </div>
                    <button type="submit" class="btn-primary">Adicionar Transa√ß√£o</button>
                </form>
            </section>

            <!-- Resumo Financeiro -->
            <section class="card">
                <h2>üìä Resumo Financeiro</h2>
                <div id="financialSummary"></div>
            </section>

            <!-- Gr√°ficos -->
            <section class="card" style="grid-column: span 2;">
                <h2>üìà Gr√°ficos</h2>
                <div class="chart-container">
                    <canvas id="lineChart"></canvas>
                </div>
            </section>

            <!-- Recomenda√ß√µes -->
            <section class="card" style="grid-column: span 2;">
                <h2>üí° Recomenda√ß√µes</h2>
                <div id="recommendations"></div>
            </section>

            <!-- Transa√ß√µes -->
            <section class="card" style="grid-column: span 2;">
                <h2>üìã Transa√ß√µes</h2>
                <div class="transactions-list" id="transactionsList"></div>
            </section>
        </div>
    </main>

    <script>
        const categoryColors = ['#9c27b0', '#7b1fa2', '#ba68c8', '#ab47bc', '#ce93d8', '#e1bee7', '#f3e5f5', '#8e24aa'];
        let selectedColor = categoryColors[0];
        let selectedTransactionType = 'expense';
        let categories = JSON.parse(localStorage.getItem('cofrinho-categories') || '[]');
        let transactions = JSON.parse(localStorage.getItem('cofrinho-transactions') || '[]');
        let lineChart = null;

        // Inicializar
        document.getElementById('transactionDate').valueAsDate = new Date();
        initColorPicker();
        renderCategories();
        renderTransactions();
        updateTransactionCategories();
        updateSummary();
        updateCharts();
        updateRecommendations();

        // Color Picker
        function initColorPicker() {
            const picker = document.getElementById('colorPicker');
            categoryColors.forEach(color => {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'color-option' + (color === selectedColor ? ' active' : '');
                btn.style.backgroundColor = color;
                btn.onclick = () => {
                    selectedColor = color;
                    initColorPicker();
                };
                picker.appendChild(btn);
            });
        }

        // Category Form
        document.getElementById('categoryForm').onsubmit = (e) => {
            e.preventDefault();
            const name = document.getElementById('categoryName').value.trim();
            const type = document.getElementById('categoryType').value;
            if (name) {
                categories.push({
                    id: Date.now().toString(),
                    name,
                    type,
                    color: selectedColor
                });
                localStorage.setItem('cofrinho-categories', JSON.stringify(categories));
                document.getElementById('categoryName').value = '';
                renderCategories();
                updateTransactionCategories();
            }
        };

        // Transaction Type Toggle
        document.querySelectorAll('.type-btn').forEach(btn => {
            btn.onclick = () => {
                selectedTransactionType = btn.dataset.type;
                document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                updateTransactionCategories();
            };
        });

        // Transaction Form
        document.getElementById('transactionForm').onsubmit = (e) => {
            e.preventDefault();
            const categoryId = document.getElementById('transactionCategory').value;
            const amount = parseFloat(document.getElementById('transactionAmount').value);
            const description = document.getElementById('transactionDescription').value.trim();
            const date = document.getElementById('transactionDate').value;
            const category = categories.find(c => c.id === categoryId);
            
            if (category && category.type === selectedTransactionType) {
                transactions.push({
                    id: Date.now().toString(),
                    categoryId,
                    amount,
                    description,
                    date,
                    type: category.type
                });
                localStorage.setItem('cofrinho-transactions', JSON.stringify(transactions));
                document.getElementById('transactionAmount').value = '';
                document.getElementById('transactionDescription').value = '';
                renderTransactions();
                updateSummary();
                updateCharts();
                updateRecommendations();
            }
        };

        function renderCategories() {
            const list = document.getElementById('categoriesList');
            list.innerHTML = categories.map(cat => `
                <div class="category-item">
                    <div class="category-color" style="background-color: ${cat.color}"></div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600;">${cat.name}</div>
                        <div style="font-size: 0.85rem; color: #666;">
                            ${cat.type === 'income' ? 'üí∞ Entrada' : 'üí∏ Sa√≠da'}
                        </div>
                    </div>
                    <button class="btn-delete" onclick="deleteCategory('${cat.id}')">√ó</button>
                </div>
            `).join('') || '<p style="text-align: center; color: #999; padding: 1rem;">Nenhuma categoria cadastrada</p>';
        }

        function deleteCategory(id) {
            categories = categories.filter(c => c.id !== id);
            transactions = transactions.filter(t => t.categoryId !== id);
            localStorage.setItem('cofrinho-categories', JSON.stringify(categories));
            localStorage.setItem('cofrinho-transactions', JSON.stringify(transactions));
            renderCategories();
            renderTransactions();
            updateTransactionCategories();
            updateSummary();
            updateCharts();
            updateRecommendations();
        }

        function updateTransactionCategories() {
            const select = document.getElementById('transactionCategory');
            const filtered = categories.filter(c => c.type === selectedTransactionType);
            select.innerHTML = '<option value="">Selecione uma categoria</option>' +
                filtered.map(cat => `<option value="${cat.id}">${cat.name}</option>`).join('');
        }

        function renderTransactions() {
            const list = document.getElementById('transactionsList');
            const sorted = [...transactions].sort((a, b) => new Date(b.date) - new Date(a.date));
            list.innerHTML = sorted.map(t => {
                const cat = categories.find(c => c.id === t.categoryId);
                const date = new Date(t.date).toLocaleDateString('pt-BR');
                const value = t.amount.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                return `
                    <div class="transaction-item" style="border-left: 4px solid ${t.type === 'income' ? '#2e7d32' : '#c62828'};">
                        <div style="font-size: 2rem;">${t.type === 'income' ? 'üí∞' : 'üí∏'}</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 1.1rem;">${t.description}</div>
                            <div style="font-size: 0.9rem; color: #666;">
                                <span style="color: ${cat?.color || '#999'};">${cat?.name || 'Categoria removida'}</span>
                                <span style="margin-left: 1rem;">${date}</span>
                            </div>
                        </div>
                        <div style="font-weight: 700; font-size: 1.2rem; color: ${t.type === 'income' ? '#2e7d32' : '#c62828'};">
                            ${t.type === 'income' ? '+' : '-'}${value}
                        </div>
                        <button class="btn-delete" onclick="deleteTransaction('${t.id}')">√ó</button>
                    </div>
                `;
            }).join('') || '<p style="text-align: center; color: #999; padding: 2rem;">Nenhuma transa√ß√£o registrada</p>';
        }

        function deleteTransaction(id) {
            transactions = transactions.filter(t => t.id !== id);
            localStorage.setItem('cofrinho-transactions', JSON.stringify(transactions));
            renderTransactions();
            updateSummary();
            updateCharts();
            updateRecommendations();
        }

        function updateSummary() {
            const income = transactions.filter(t => t.type === 'income').reduce((s, t) => s + t.amount, 0);
            const expense = transactions.filter(t => t.type === 'expense').reduce((s, t) => s + t.amount, 0);
            const balance = income - expense;
            
            const format = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            const percentage = income > 0 ? ((expense / income) * 100).toFixed(1) : 0;
            
            document.getElementById('financialSummary').innerHTML = `
                <div class="summary-item" style="border-left: 4px solid #2e7d32;">
                    <div style="font-size: 2.5rem;">üí∞</div>
                    <div style="flex: 1;">
                        <div style="font-size: 0.9rem; color: #666;">Total de Entradas</div>
                        <div class="summary-value income">${format(income)}</div>
                    </div>
                </div>
                <div class="summary-item" style="border-left: 4px solid #c62828;">
                    <div style="font-size: 2.5rem;">üí∏</div>
                    <div style="flex: 1;">
                        <div style="font-size: 0.9rem; color: #666;">Total de Sa√≠das</div>
                        <div class="summary-value expense">${format(expense)}</div>
                        ${income > 0 ? `<div style="font-size: 0.85rem; color: #999;">${percentage}% das entradas</div>` : ''}
                    </div>
                </div>
                <div class="summary-item" style="border-left: 4px solid ${balance >= 0 ? '#2e7d32' : '#c62828'};">
                    <div style="font-size: 2.5rem;">${balance >= 0 ? '‚úÖ' : '‚ö†Ô∏è'}</div>
                    <div style="flex: 1;">
                        <div style="font-size: 0.9rem; color: #666;">Saldo Atual</div>
                        <div class="summary-value balance ${balance >= 0 ? 'positive' : 'negative'}">${format(balance)}</div>
                        ${balance < 0 ? '<div style="font-size: 0.85rem; color: #c62828; font-weight: 600;">Voc√™ est√° no negativo!</div>' : ''}
                    </div>
                </div>
            `;
        }

        function updateCharts() {
            const ctx = document.getElementById('lineChart').getContext('2d');
            if (lineChart) lineChart.destroy();
            
            const byDate = {};
            transactions.forEach(t => {
                if (!byDate[t.date]) byDate[t.date] = { date: t.date, income: 0, expense: 0, profit: 0 };
                if (t.type === 'income') byDate[t.date].income += t.amount;
                else byDate[t.date].expense += t.amount;
                byDate[t.date].profit = byDate[t.date].income - byDate[t.date].expense;
            });
            
            const data = Object.values(byDate).sort((a, b) => new Date(a.date) - new Date(b.date))
                .map(item => ({
                    ...item,
                    date: new Date(item.date).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' })
                }));
            
            if (data.length > 0) {
                lineChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.map(d => d.date),
                        datasets: [
                            {
                                label: 'Entradas',
                                data: data.map(d => d.income),
                                borderColor: '#2e7d32',
                                backgroundColor: 'rgba(46, 125, 50, 0.1)',
                                tension: 0.4
                            },
                            {
                                label: 'Sa√≠das',
                                data: data.map(d => d.expense),
                                borderColor: '#c62828',
                                backgroundColor: 'rgba(198, 40, 40, 0.1)',
                                tension: 0.4
                            },
                            {
                                label: 'Lucro',
                                data: data.map(d => d.profit),
                                borderColor: '#9c27b0',
                                backgroundColor: 'rgba(156, 39, 176, 0.1)',
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true },
                            tooltip: {
                                callbacks: {
                                    label: (context) => {
                                        return context.dataset.label + ': ' + 
                                            context.parsed.y.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: (value) => 'R$ ' + value.toLocaleString('pt-BR')
                                }
                            }
                        }
                    }
                });
            } else {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.font = '16px sans-serif';
                ctx.fillStyle = '#999';
                ctx.textAlign = 'center';
                ctx.fillText('Adicione transa√ß√µes para ver os gr√°ficos', ctx.canvas.width / 2, ctx.canvas.height / 2);
            }
        }

        function updateRecommendations() {
            const income = transactions.filter(t => t.type === 'income').reduce((s, t) => s + t.amount, 0);
            const expense = transactions.filter(t => t.type === 'expense').reduce((s, t) => s + t.amount, 0);
            const balance = income - expense;
            
            const format = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            const recommendations = [];
            
            if (balance < 0) {
                recommendations.push(`‚ö†Ô∏è Voc√™ precisa reduzir ${format(Math.abs(balance))} para sair do negativo.`);
                
                const expensesByCat = categories.filter(c => c.type === 'expense').map(cat => {
                    const total = transactions.filter(t => t.categoryId === cat.id && t.type === 'expense')
                        .reduce((s, t) => s + t.amount, 0);
                    return { category: cat, total, percentage: expense > 0 ? (total / expense) * 100 : 0 };
                }).filter(item => item.total > 0).sort((a, b) => b.total - a.total);
                
                if (expensesByCat.length > 0) {
                    const top = expensesByCat[0];
                    const needed = Math.abs(balance);
                    if (needed <= top.total) {
                        const percent = ((needed / top.total) * 100).toFixed(0);
                        recommendations.push(`üí° Reduza ${percent}% dos gastos em "${top.category.name}" (${format(needed)}) para equilibrar suas finan√ßas.`);
                    }
                }
            } else {
                const savings = expense > 0 ? ((balance / (balance + expense)) * 100).toFixed(1) : '100';
                recommendations.push(`‚úÖ √ìtimo! Voc√™ est√° com saldo positivo de ${format(balance)}.`);
                recommendations.push(`üí∞ Voc√™ est√° economizando ${savings}% da sua renda. Continue assim!`);
            }
            
            const expensesByCat = categories.filter(c => c.type === 'expense').map(cat => {
                const total = transactions.filter(t => t.categoryId === cat.id && t.type === 'expense')
                    .reduce((s, t) => s + t.amount, 0);
                return { category: cat, total, percentage: expense > 0 ? (total / expense) * 100 : 0 };
            }).filter(item => item.total > 0).sort((a, b) => b.total - a.total);
            
            if (expensesByCat.length > 0) {
                const top3 = expensesByCat.slice(0, 3);
                recommendations.push(`üìä Suas maiores despesas: ${top3.map(c => `${c.category.name} (${c.percentage.toFixed(1)}%)`).join(', ')}.`);
                
                expensesByCat.filter(c => c.percentage > 30).forEach(c => {
                    recommendations.push(`‚ö†Ô∏è "${c.category.name}" representa ${c.percentage.toFixed(1)}% dos seus gastos. Considere revisar essa categoria.`);
                });
            }
            
            document.getElementById('recommendations').innerHTML = recommendations.length > 0
                ? recommendations.map(r => `<div class="recommendation-item"><p>${r}</p></div>`).join('')
                : '<p style="text-align: center; color: #999; padding: 2rem;">Adicione transa√ß√µes para receber recomenda√ß√µes</p>';
        }
    </script>
</body>
</html>

